<?xml version="1.0" encoding="UTF-8"?>
<!-- You may freely edit this file. See harness/README in the NetBeans platform -->
<!-- for some information on what you could do (e.g. targets to override). -->
<!-- If you delete this file and reopen the project it will be recreated. -->
<project name="opensim" basedir=".">
    <description>Builds the module suite opensim.</description>
    <property name="api.dir" value="C:/Dev/gui/opensim-gui/OpenSimAPI-install"/>
    <property name="apiJava.dir" value="C:/Dev/gui/opensim-gui/OpenSimAPI-install/sdk/Java/org"/>
    <property name="models.dir" value="C:/Dev/gui/opensim-models"/>
    <property name="visualizer.dir" value="C:/Dev/opensim-threejs"/>
    <property name="jre.dir" value="${java.home}"/>
    <condition property="installer-files.dir" value="installer_files/Windows">
        <os family="windows"/>
    </condition>
    <condition property="installer-files.dir" value="installer_files/OSX">
        <os family="mac"/>
    </condition>
    <condition property="installer-files.dir" value="installer_files/Linux">
        <!-- Ant allows detecting unix, but not linux. We assume non-mac unix
             is Linux.-->
        <and>
            <os family="unix"/>
            <not>
                <os family="mac"/>
            </not>
        </and>
    </condition>
    <condition property="opensimdist.dir" value="dist/installer/opensim">
        <os family="windows"/>
    </condition>
    <condition property="opensimdist.dir" value="dist/OpenSim.app/Contents/Resources/opensim">
        <os family="mac"/>
    </condition>
    <property name="app.conf" value="${installer-files.dir}/opensim.conf"/>
    <import file="nbproject/build-impl.xml"/>
    <target name="debug-properties">
        <echoproperties/>
    </target>
    <target name="copy-java-bindings" description="Copy results of builing opensim-core with Java Bindings to gui">
         <copy todir="modeling/src/org/opensim/modeling">
            <fileset dir="${apiJava.dir}/opensim/modeling" />
        </copy>
    </target>
    <target name="unzip-distro" depends="build-zip" 
            description="unZIP distribution of the suite, launchers, and selected modules from the platform.">
        <unzip src="dist/opensim.zip" dest="dist/installer" />
    </target>
    <target name="copy-installer-files" depends="unzip-distro" 
            description="Copy prebuilt opensim-core installayion into installer folder">
        <copy todir="dist/installer/opensim/bin">
            <fileset dir="${api.dir}/bin"/>
        </copy>
        <copy todir="dist/installer/opensim/cmake">
            <fileset dir="${api.dir}/cmake"/>
        </copy>
        <copy todir="dist/installer/opensim/sdk">
            <fileset dir="${api.dir}/sdk"/>
        </copy>
    </target>
    <target name="copy-jre" description="Copy JRE to installer">
        <!-- Only used on Windows. -->
        <copy todir="${opensimdist.dir}/jdk/jre">
            <fileset dir="${jre.dir}"/>
        </copy>
    </target>
    <target name="copy-models" description="Copy Models and Geometry to installer">
        <copy todir="${opensimdist.dir}/Geometry">
            <fileset dir="${models.dir}/Geometry"/>
        </copy>
        <copy todir="${opensimdist.dir}/Models">
            <fileset dir="${models.dir}/models"/>
        </copy>
    </target>
    <target name="copy-visualizer" description="Copy Visualizer to installer">
        <copy todir="${opensimdist.dir}/threejs">
            <fileset dir="${visualizer.dir}/three.js">
                <exclude name="**/docs/**"/>
                <exclude name="**/test/**"/>
                <exclude name="**/examples/**"/>
            </fileset>
        </copy>
        <copy todir="${opensimdist.dir}/threejs/examples/js">
            <fileset dir="${visualizer.dir}/three.js/examples/js" />
        </copy>
        <!--<copy todir="${opensimdist.dir}/threejs/build">
            <fileset dir="${visualizer.dir}/build"/>
        </copy>-->
    </target>
    <target name="build-mac-installer" depends="build-mac">
        <property name="lib.dir" value="/Users/aymanhabib/dev/install/opensim-core-install/lib"/>
        <echoproperties/>
        <copy todir="${opensimdist.dir}/lib">
            <fileset dir="${lib.dir}"/>
        </copy>
        <!-- Must use the OS's cp because Ant's copy doesn't preserve file
             permissions (e.g., the executable bit). TODO exclude unnecessary
             files
             (http://www.oracle.com/technetwork/java/javase/jre-8-readme-2095710.html);
             doing so could save about 50 MB from the size of the installation.
             -->
        <exec executable="cp">
            <arg line="-R ${jre.dir}/ ${opensimdist.dir}/jre"/>
        </exec>
        <!--<copy tofile="dist/opensim.app/Contents/Info.plist" file="installer_files/OSX/Info.plist"/>-->
    </target>
</project>
